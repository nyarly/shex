(schema
 (shapes
  (
   (<http://a.example/S1>
    (and
     (nodeConstraint iri (pattern "^https?://"))
     (shape
      (eachOf
       (tripleConstraint <http://a.example/p1>
        (nodeConstraint (datatype <http://a.example/dt>)))
       (tripleConstraint <http://a.example/p2>
        (and
         (nodeConstraint bnode)
         (shape
          (eachOf
           (tripleConstraint <http://a.example/p3> (nodeConstraint literal))
           (tripleConstraint <http://a.example/p4>
            (and (nodeConstraint iri (pattern "^https://")) (shapeRef <http://a.example/S1>))
            (min 0)
            (max 1)) ))
         (shape closed
          (eachOf
           (tripleConstraint <http://a.example/p3>)
           (tripleConstraint <http://a.example/p4>)) )) )) )) )) ))